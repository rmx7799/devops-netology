# Домашнее задание к занятию "5.1. Введение в виртуализацию. Типы и функции гипервизоров. Обзор рынка вендоров и областей применения."



## Задача 1

Опишите кратко, как вы поняли: в чем основное отличие полной (аппаратной) виртуализации, паравиртуализации и виртуализации на основе ОС.

Ответ:

При использовании паравиртуализации, гостевая ОС использует только ресурсы, которые выделены гипервизором. В паравиртуализации имеется слой гипервизора, который  отвечает за разделение ресурсов в хостовой машине и существляет взаимодействия между гостевой ос и оборудовании сервера (проц, памярь, сеть, хранилище).

При использовании контейнеров (виртуализация на основе ОС) иная ситуация. Контейнеры могут использовать все доступные ресурсы хостовой машины. Помимо этого используются общие динамические библиотеки, общие страницы  памяти на хостовой машине, что может экономить ресурсы. В контейнерной виртуализации, контейнер обращается напрямую в ОС без слоя гипервизора, разделение ресурсов между контейнерами осуществляется на уровне ОС. 

## Задача 2

Выберите один из вариантов использования организации физических серверов, в зависимости от условий использования.

Организация серверов:
- физические сервера,
- паравиртуализация,
- виртуализация уровня ОС.

Условия использования:
- Высоконагруженная база данных, чувствительная к отказу.
- Различные web-приложения.
- Windows системы для использования бухгалтерским отделом.
- Системы, выполняющие высокопроизводительные расчеты на GPU.

Опишите, почему вы выбрали к каждому целевому использованию такую организацию.

Ответ:

1) Высоконагруженная база данных, чувствительная к отказу

   Организация -   Физический сервер 

   Пояснения: требуется высокая производительность, аппаратное размещение дает более быстрый  отклик и сокращает точки отказа в виде гипервизора хостовой машны.
   Возможен другой вариант - использование аппаратной виртуализации (VMware) с кластеризацией VMware HA для повышения доступности

2) Различные Java-приложения
   
   Организация - Виртуализация уровня ОС (контейнеры)

   Пояснения:  Требуется меньше ресурсов, быстрое масштабирование при необходимости расширения системы. отстутствие жестких требований к аппаратнымм ресурсам.

3) Windows системы для использования Бухгалтерским отделом

   Организация - Паравиртуализация 

     Пояснения:  простой способ создания резервных копий или клонирования всей ВМ (виртупльной машины) , возможность оперативного расширения ресурсов ВМ. нет критичных требований к доступу к аппаратной составляющей сервера (например, быстрый отклик).
        
4) Системы, выполняющие высокопроизводительные расчеты на GPU

   Организация - Физические сервера 

      Пояснения: для аппаратных расчетов требуется максимальный быстрый доступ к аппаратным ресурсам напрямую без ОС гипервизора, который физический сервер дает эффективно. 

## Задача 3

Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.

Сценарии:

1. 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.
2. Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.
3. Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры.
4. Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.

Ответ:

1. 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий. 

Предложение: Hyper-V 

Пояснения:

Hyper-V является выбором defacto для окружений с преобладанием технологий Microsoft.

Microsoft NLB - для балансировки трафика, Компонент балансировки сетевой нагрузки (NLB) распределяет трафик по нескольким серверам с помощью сетевого протокола TCP/IP. Объединяя несколько компьютеров, на которых запущены приложения, в единый виртуальный кластер, NLB обеспечивает надежность и быстродействие веб-серверов и других ответственных серверов.

Репликация виртуальных машин Hyper-V. ри включении реплики Hyper-V для конкретной виртуальной машины при начальной репликации создается идентичная реплика виртуальной машины на сервере вторичного узла. После этого система отслеживания изменений реплики Hyper-V создает и поддерживает файл журнала, который фиксирует изменения на виртуальном жестком диске виртуальной машины.

Windows Backup. В Windows Server и в Hyper-V есть нативная поддержка теневых копий, Volume Shadow Copy Service (VSS). Посредством этой технологии обеспечивается резервное копирование виртуальной среды, вне зависимости от решения и средства резервного копирования. 

2. Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.

Предложение: Xen

Пояснения:

Xen с его надежностью и стабильностью подойдет для большинства пользователей, как универсальный гипервизор для Linux и Windows машин.

Xen очень зрелый продукт, большинство людей выбирают его для хорошей производительности и исключительной стабильности.Стабильность Xen обеспечивается, за счет, предварительно выделяемой RAM и CPU для гипервизора, а так как он имеет свои собственные выделенные ресурсы, то на него не могут повлиять гостевые ОС, что и дает пресловутую стабильность в работе.

Основной принцип паравиртуализации заключается в подготовке гостевых операционных систем путем незначительной модификации их ядра перед исполнением в виртуализированной среде. Это накладывает определенные ограничения на выбор используемых систем, так как от операционной системы требуется предоставление возможности внесения изменений в ее исходный код. Это касается как хост-систем, так и гостевых систем.

Вторым фактором, который относится к особенностям XEN, является незначительный объем кода самого гипервизора. Это достигается за счет выноса большего количества функций управления за пределы самого гипервизора. В рамках гипервизора разработчики оставили следующие функции:

управление оперативной памятью и тактовой частотой (TSC) процессора,
контроль за прерываниями и DMA (англ. direct memory access, прямой доступ к памяти),
таймер реального времени.


3. Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры.

Предложение: Xen

Пояснения:

Xen с его надежностью и стабильностью подойдет для большинства пользователей, как универсальный гипервизор для Linux и Windows машин.

Xen очень зрелый продукт, большинство людей выбирают его для хорошей производительности и исключительной стабильности.Стабильность Xen обеспечивается, за счет, предварительно выделяемой RAM и CPU для гипервизора, а так как он имеет свои собственные выделенные ресурсы, то на него не могут повлиять гостевые ОС, что и дает пресловутую стабильность в работе.

Основной принцип паравиртуализации заключается в подготовке гостевых операционных систем путем незначительной модификации их ядра перед исполнением в виртуализированной среде. Это накладывает определенные ограничения на выбор используемых систем, так как от операционной системы требуется предоставление возможности внесения изменений в ее исходный код. Это касается как хост-систем, так и гостевых систем.

Вторым фактором, который относится к особенностям XEN, является незначительный объем кода самого гипервизора. Это достигается за счет выноса большего количества функций управления за пределы самого гипервизора. В рамках гипервизора разработчики оставили следующие функции:

управление оперативной памятью и тактовой частотой (TSC) процессора,
контроль за прерываниями и DMA (англ. direct memory access, прямой доступ к памяти),
таймер реального времени.

4. Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.

Предложение: KVM

Пояснения:

KVM является представителем паравиртуализации, вы можете запустить практически любую операционную систему в качестве гостевой  —  BSD / Windows / Linux и с драйвером virtio вы получите близкую к нативной производительность

KVM является нативным для большинства современных ядер Linux.Это дает преимущество в производительности по сравнению с другими системами виртуализации. При этом данный продукт относительно новый и находится в активном развитии.Большинство людей выбирают KVM из-за более низкого порога входа.

Если вы хотите сэкономить деньги и ваши окружения представляют собой исключительно Linux, то KVM может стать неплохим вариантом платформы виртуализации.

## Задача 4

Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, то создавали бы вы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.

Ответ:

Трудоемкость администрирования и мониторинга нескольких платформ виртуализации.
Проблемы с миграцией ВМ из одной среды в другую (для части ВМ придется конвертацию и выключать ВМ). 

Я бы не создавал  гетерогенную среду, т.к. потребуется много следить (несколько консолей для управления, проблемы с ошибками придется получить много опыта чтобы поддерживать несколько платформ виртуализации).

Хотя возможен вариант: например в продуктиве используется Vmware vSphere , а для тестовой среды и среды разработки KVM.
